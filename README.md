![Синтезатор на ESP32](https://github.com/AscendingAlpha/AudioSynthesizer/blob/main/AudioSynthesizer.png)

# Синтезатор на ESP32

## Эффекты:
* ДИЛЭЙ / ЭХО
* ФЛЭНДЖЕР
* ТРЕМОЛО
* ВИБРАТО
* Изменение тональности / громкости
* КЛИППИНГ (ДИСТОРШН / ОВЕРДРАЙВ)

## Особенности синтезатора
__Тип синтеза: аддитивный__

![Параметры синтеза](https://github.com/AscendingAlpha/AudioSynthesizer/blob/main/SynthParams.png)

Параметры (задаются глобально, но применяются для каждой ноты отдельно):
* _waves_count_ - количество дополнительных частот (помимо основной частоты ноты)
* _detune_ - шаг дополнительных частот
* _decrease_ - спад дополнительных частот

__Тип несущей волны (осциллятор): синусоида__

__Типы модулирующих волн (НЧ-осциллятор):__
* Синусоида
* Прямоугольная (меандр)
* Треугольная
* Пилообразная

__Способ вывода звука: внешний ЦАП - шина I2S__
____
В примере реализовано управление звучащими нотами через терминал:
* Байты в диапазоне [1, NOTES_COUNT] - соответствующая клавиша _НАЖАТА_
* Байты в диапазоне [NOTES_COUNT + 1, 2 * NOTES_COUNT] - соответствующая клавиша _ОТПУЩЕНА_

Управление осциллятором: амплитуды частот задаются в массиве __ampl__

Управление ADSR-огибающей: состояние клавиш задаётся в массиве __note__:
* _ATTACK_ - клавиша нажата
* _RELEASE_ - клавиша отпущена
ADSR-огибающая __автоматически__ управляет осциллятором (массивом ampl)

## Перечень компонентов:
* ADC (работа с АЦП)
* I2S (работа с шиной I2S)
* Oscil (осциллятор, применение эффектов, вывод звука на ЦАП)
* Envelope (ADSR-огибающая, управление осциллятором)
* PitchShifter (изменение тональности звучания)
* VolumeAdjust (изменение громкости звучания)
* Vibrato (эффект ВИБРАТО, модуляция компонента PitchShifter)
* Tremolo (эффект ТРЕМОЛО, модуляция компонента VolumeAdjust)
* Clipping (эффект КЛИППНГ – ДИСТОРШН и ОВЕРДРАЙВ)
* LFO (низкочастотный осциллятор, нужен для компонентов Vibrato, Tremolo и Flanger)
* DelayLine (линия задержки для компонентов Delay и Flanger)
* Delay (эффект ДИЛЭЙ / ЭХО)
* Flanger (эффект ФЛЭНДЖЕР)
* Timer (прерывания по таймеру)
____
_Пример содержит предварительно сконфигурированный sdkconfig_

## Параметры, с которыми тестировалась прошивка (приведены некоторые, работоспособность с другими параметрами не гарантируется):
* Bootloader config -> Bootloader optimization Level: _Optimize for performance (-O2)_
* Compiler options -> Optimization Level: _Optimize for performance (-O2)_
* Partition Table -> Partition Table: _Single factory app (large), no OTA_
* ESP System Settings -> CPU frequency: _240 MHz_
* GPTimer Configuration -> Place GPTimer control fuctions into IRAM: _1_
* Скорость последовательного порта: _115200 бод_
* Количество нот: _120_
* Минимально возможная частота синтеза: _20 Гц_
* Максимально возможная частота синтеза: _20 кГц_
* Шаг изменения частоты: _1 Гц_
* Разрешение осциллятора: _50_
* Разрешение НЧ-осциллятора: _100_
* Минимальное время атаки ADSR-огибающей: _0,01 с_
* Максимальное время атаки ADSR-огибающей: _1 с_
* Минимальное время спада ADSR-огибающей: _0,01 с_
* Максимальное время спада ADSR-огибающей: _1 с_
* Минимальное время затухания ADSR-огибающей: _0,01 с_
* Максимальное время затухания ADSR-огибающей: _1 с_
* Разрешение ADSR-огибающей: _100_
* Максимальное время линии задержки: _0,5 с_
* Аудиовыход: _стерео_
* Частота дискретизации: _44,1 кГц_
* Глубина дискретизации: _32 бит_

`ОБРАТИТЕ ВНИМАНИЕ: в sdkconfig флаг GPTimer Configuration -> Place GPTimer control fuctions into IRAM должен быть установлен ОБЯЗАТЕЛЬНО!`
